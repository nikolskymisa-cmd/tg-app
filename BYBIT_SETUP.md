# TG VPN App - Telegram Mini App –¥–ª—è –ø—Ä–æ–¥–∞–∂–∏ VPN

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è
- Node.js 16+
- npm
- Telegram Bot Token
- Bybit API –∫–ª—é—á–∏ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ sandbox —Ä–µ–∂–∏–º–µ)

### –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone https://github.com/nikolskymisa-cmd/tg-app
cd tg-app

# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
npm install

# –ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å –∏ –∑–∞–ø–æ–ª–Ω–∏—Ç—å .env —Ñ–∞–π–ª
cp .env.example .env
```

## üîê –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Bybit Integration

### –®–∞–≥ 1: –ü–æ–ª—É—á–∏—Ç—å API –∫–ª—é—á–∏ Bybit

1. –ó–∞–π—Ç–∏ –Ω–∞ https://www.bybit.com
2. –ü–æ—Å–ª–µ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø–µ—Ä–µ–π—Ç–∏ –≤ **Account Settings** ‚Üí **API**
3. –ù–∞–∂–∞—Ç—å **Create New Key**
4. –í—ã–±—Ä–∞—Ç—å —Ç–∏–ø –¥–æ—Å—Ç—É–ø–∞: **Personal Trading**
5. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è:
   - ‚úÖ Read (Payment)
   - ‚úÖ Submit (Payment)
6. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å **API Key** –∏ **API Secret**

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å .env —Ñ–∞–π–ª

–°–æ–∑–¥–∞—Ç—å —Ñ–∞–π–ª `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
# Telegram
BOT_TOKEN=8799078480:AAEPLh4n4oKY3Q-zKhWiM2TQXJazyqJ1l4w
WEBAPP_URL=https://tg-app-2n4r.onrender.com

# JWT
JWT_SECRET=strong_secret_key_change_this

# Bybit
BYBIT_API_KEY=your_api_key_from_bybit
BYBIT_API_SECRET=your_api_secret_from_bybit
BYBIT_USE_SANDBOX=false  # true –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è, false –¥–ª—è production
BYBIT_WEBHOOK_SECRET=your_webhook_secret

# Server
PORT=3000
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Webhook (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –¥–ª—è production)

1. –í Bybit API settings –¥–æ–±–∞–≤–∏—Ç—å **Webhook**:
   - URL: `https://your-domain.com/payment/webhook`
   - Events: `Payment Completed`, `Payment Failed`
2. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å **Webhook Secret** –≤ `.env`

### –®–∞–≥ 4: –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–µ—Ä

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ
npm start

# –ò–ª–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –∞–≤—Ç–æ–ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–æ–π
npm install -g nodemon
nodemon server.js
```

## üìö API Endpoints

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- `POST /auth/telegram` - –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram initData

### VPN –ü–∞–∫–µ—Ç—ã
- `GET /vpn/packages` - –ü–æ–ª—É—á–∏—Ç—å —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –ø–∞–∫–µ—Ç–æ–≤
- `POST /vpn/package` - –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤—ã–π –ø–∞–∫–µ—Ç (–∞–¥–º–∏–Ω)

### –ü–ª–∞—Ç–µ–∂–∏
- `POST /vpn/payment` - –ò–Ω–∏—Ü–∏–∏—Ä–æ–≤–∞—Ç—å –ø–ª–∞—Ç–µ–∂
  ```json
  {
    "packageId": 1,
    "method": "crypto"  // –∏–ª–∏ "card"
  }
  ```
  –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `{ paymentUrl, orderId, transactionId }`

- `GET /vpn/payment-status/:orderId` - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞
  
- `POST /payment/webhook` - Webhook –æ—Ç Bybit (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π)

### –ü–æ–¥–ø–∏—Å–∫–∏
- `GET /vpn/subscriptions` - –ü–æ–ª—É—á–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–µ –ø–æ–¥–ø–∏—Å–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `POST /vpn/complete-payment` - –ó–∞–≤–µ—Ä—à–∏—Ç—å –ø–ª–∞—Ç–µ–∂ –∏ —Å–æ–∑–¥–∞—Ç—å –ø–æ–¥–ø–∏—Å–∫—É

### –ü—Ä–æ—Ñ–∏–ª—å
- `GET /me` - –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üí≥ –ü—Ä–æ—Ü–µ—Å—Å –æ–ø–ª–∞—Ç—ã

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤—ã–±–∏—Ä–∞–µ—Ç –ø–∞–∫–µ—Ç** –∏ —Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã (–∫—Ä–∏–ø—Ç–æ/–∫–∞—Ä—Ç–∞)
2. **–°–∏—Å—Ç–µ–º–∞ —Å–æ–∑–¥–∞–µ—Ç –∑–∞–∫–∞–∑** –≤ Bybit –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å—Å—ã–ª–∫—É
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –Ω–∞ Bybit** –¥–ª—è –æ–ø–ª–∞—Ç—ã
4. **–ü–æ—Å–ª–µ –æ–ø–ª–∞—Ç—ã** Bybit –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç webhook –∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
5. **–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å –ø–ª–∞—Ç–µ–∂–∞** –∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç VPN –∫–ª—é—á
6. **VPN –∫–ª—é—á –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é**

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Sandbox —Ä–µ–∂–∏–º Bybit

–î–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Bybit Testnet:

```env
BYBIT_USE_SANDBOX=true
```

API URL –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∫–ª—é—á–∏—Ç—Å—è –Ω–∞ `https://api-testnet.bybit.com`

### Demo —Ä–µ–∂–∏–º

–ï—Å–ª–∏ Bybit API –∫–ª—é—á–∏ –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã, –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ demo —Ä–µ–∂–∏–º —Å mock –ø–ª–∞—Ç–µ–∂–∞–º–∏.

## üì¶ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
tg-app/
‚îú‚îÄ‚îÄ server.js          # Express —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ bot.js             # Telegram –±–æ—Ç
‚îú‚îÄ‚îÄ db.js              # SQLite –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ payment.js         # Bybit –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ config.js          # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ seed.js            # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
‚îú‚îÄ‚îÄ package.json       # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ public/
‚îÇ   ‚îî‚îÄ‚îÄ index.html     # Telegram WebApp UI
‚îú‚îÄ‚îÄ .env.example       # –ü—Ä–∏–º–µ—Ä –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ vpn.db             # SQLite –±–∞–∑–∞ (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
```

## üîß –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –û–ø–∏—Å–∞–Ω–∏–µ | –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é |
|-----------|---------|-------------|
| BOT_TOKEN | Telegram Bot Token | - |
| WEBAPP_URL | URL –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è | http://localhost:3000 |
| JWT_SECRET | Secret –¥–ª—è JWT —Ç–æ–∫–µ–Ω–æ–≤ | dev_secret_change_me |
| PORT | –ü–æ—Ä—Ç —Å–µ—Ä–≤–µ—Ä–∞ | 3000 |
| BYBIT_API_KEY | API Key –æ—Ç Bybit | - |
| BYBIT_API_SECRET | API Secret –æ—Ç Bybit | - |
| BYBIT_USE_SANDBOX | –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å sandbox | true |
| BYBIT_WEBHOOK_SECRET | Secret –¥–ª—è webhook'–æ–≤ | - |

## üöÄ Deployment –Ω–∞ Render

1. Push –Ω–∞ GitHub
2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –∫ Render
3. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Render dashboard
4. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Ä–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ –∫–∞–∂–¥—ã–π push

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- ‚úÖ HMAC-SHA256 –ø–æ–¥–ø–∏—Å—å –¥–ª—è Telegram initData
- ‚úÖ JWT —Ç–æ–∫–µ–Ω—ã –¥–ª—è API –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- ‚úÖ Webhook –ø–æ–¥–ø–∏—Å—å –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–ª—è Bybit
- ‚ö†Ô∏è **–í production –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ:**
  - –ò–∑–º–µ–Ω–∏—Ç—å JWT_SECRET –Ω–∞ —Å–ª—É—á–∞–π–Ω—ã–π –∫–ª—é—á
  - –•—Ä–∞–Ω–∏—Ç—å –≤—Å–µ –∫–ª—é—á–∏ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å HTTPS
  - –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å WAF –µ—Å–ª–∏ –≤–æ–∑–º–æ–∂–Ω–æ

## üìù –õ–∏—Ü–µ–Ω–∑–∏—è

MIT

## üë§ –ê–≤—Ç–æ—Ä

nikolskymisa-cmd

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü–æ –≤–æ–ø—Ä–æ—Å–∞–º –æ–±—Ä–∞—â–∞—Ç—å—Å—è –≤ Telegram: @nikolskymisa
